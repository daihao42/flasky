{% extends '__base__.html' %}

{% import "_macros.html" as macros %} <!--分页宏-->

{{ super() }}

{% block title %}首页{% endblock %}

{% block beforehead %}
<!--
<script src="/static/js/vue.min.js"></script> 
<script>
  function showFormError(str){
    info = "<div class='alert alert-warning alert-dismissible' role='alert'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button>"
    info+=str;
    info+="</div>"
    $("div").remove(".alert");
    $("form").prepend(info)
  }

function initVM(post){
    var vm = new Vue({
        el: '#vm',
        data: post,
        methods: {
            submit: function (event) {
                event.preventDefault();
                var $form = $('#vm');
                $.ajax({
                    type: "POST",
                    url: "/",
                    data: {title: this.title.trim(),
                          body: this.body},
                    dataType: "text",
                    success: function(data){
                            return location.assign('/');
                      },
                    error: function (msg) {
                    showFormError(msg.responseText);
                } 
                  });
            }
        }
    });
    $('#vm').show();
}

$(function () {
        initVM({
            title: '',
            body: ''
        });
});
</script>
-->
{% endblock %}

{% block content %}
<a href="/auth/login">登陆</a>
<a href="/auth/register">注册</a>
<a href="/auth/logout">登出</a>
<a href="/edit">编辑</a>

{% if current_user.is_authenticated %}
{{ current_user.username }}
<img src={{ current_user.image }}>
<a href="/user/{{ current_user.username }}">个人主页</a>

<!--
{% if current_user.can(Permission.WRITE_ARTICLES) %}
<div class="container">
  <form class="form-vertical" id="vm" v-on="submit: submit">
        <div class="form-group">
          <label class="fa-label">
              <i class="fa fa-user"></i>
            </label>
          <label class="control-label">标题</label>
          <div class="controls">
            <input class="form-control" v-model="title" type="text" required placeholder='标题' />
            <div class="help-block"></div>
          </div>
        </div>

        <div class="form-group">
          <label class="fa-label">
              <i class="fa fa-unlock-alt"></i>
            </label>
          <label class="control-label">内容</label>
          <div class="controls">
             <textarea v-model="body" placeholder="内容" style="resize:none;"></textarea>
          </div>
        </div>

        <div class="form-group">
          <input class="login-btn btn-primary btn" type="submit" value="提交" />
          </div>
      </form> 
</div>
{% endif %}
-->

{% else %}
Stranger
{% endif %}

<!-- blog的显示页面 -->
{% include '_posts.html' %}

<!--分页-->
<div class="pagination">
{{ macros.pagination_widget(pagination, '.index') }}
</div>

{% endblock %}


